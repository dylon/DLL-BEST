(function(h){function e(d){this.__super__(d)}h=h.DllBest;var c=h.Avl||(h.Avl={});e.inherits(h.Node);e.prototype.isLeaf=function(){return this.height===0};e.prototype.isBranch=function(){var d=!!this.lChild,a=!!this.rChild;return d&&!a||!d&&a};e.prototype.maxChildHeight=function(){var d=this.lChild?this.lChild.height:-1,a=this.rChild?this.rChild.height:-1;return d>a?d:a};e.prototype.balance=function(){return(this.lChild?this.lChild.height:-1)-(this.rChild?this.rChild.height:-1)};e.prototype.isBalanced=
function(){var d=this.balance();return d>=-1&&d<=1};e.prototype.height=0;e.prototype.assign=function(d,a){this.__proto__.assign(d,a);this.height=d.height};e.prototype.toString=function(){return this.value+"("+this.height+")"};c.Node=e})(window);(function(h){function e(a){this.__super__(d,a)}h=h.DllBest;var c=h.Avl||(h.Avl={}),d=c.Node;e.inherits(h.Tree);e.prototype.rebalance=function(a){var b,f;b=a.balance();var g=a.parent;if(b<=-2)if(a.rChild.balance()<=0){b=a.rChild;a.rChild=b.lChild;if(a.rChild)a.rChild.parent=a;b.lChild=a;a.parent=b;if(g){if(g.rChild===a)g.rChild=b;else g.lChild=b;b.parent=g}else{this.root=b;this.root.parent=null}this.recomputeHeights(a);this.recomputeHeights(b.parent)}else{b=a.rChild;f=b.lChild;b.lChild=f.rChild;if(b.lChild)b.lChild.parent=
b;a.rChild=f.lChild;if(a.rChild)a.rChild.parent=a;f.rChild=b;b.parent=f;f.lChild=a;a.parent=f;if(g){if(g.rChild===a)g.rChild=f;else g.lChild=f;f.parent=g}else{this.root=f;this.root.parent=null}this.recomputeHeights(a);this.recomputeHeights(b)}else if(b>=2)if(a.lChild.balance()>=0){b=a.lChild;a.lChild=b.rChild;if(a.lChild)a.lChild.parent=a;b.rChild=a;a.parent=b;if(g){if(g.rChild===a)g.rChild=b;else g.lChild=b;b.parent=g}else{this.root=b;this.root.parent=null}this.recomputeHeights(a);this.recomputeHeights(b.parent)}else{b=
a.lChild;f=b.rChild;a.lChild=f.rChild;if(a.lChild)a.lChild.parent=a;b.rChild=f.lChild;if(b.rChild)b.rChild.parent=b;f.lChild=b;b.parent=f;f.rChild=a;a.parent=f;if(g){if(g.rChild===a)g.rChild=f;else g.lChild=f;f.parent=g}else{this.root=f;this.root.parent=null}this.recomputeHeights(a);this.recomputeHeights(b)}};e.prototype.sanityCheck=function(a){var b;if(!a)a=this.root;if(!(!a||a.isLeaf()&&!a.parent)){b=a.maxChildHeight()+1;if(a.height!==b)throw"Invalid height for node "+a+": "+a.height+" instead of "+
b+"!";b=a.balance();if(b<-1||b>1)throw"Balance factor for node "+a+" is "+b+"!";if(a.lChild===a)throw"Circular reference for node "+a+": node.lChild is node!";if(a.rChild===a)throw"Circular reference for node "+a+": node.rChild is node!";if(a.lChild){if(a.lChild.parent!==a)throw"Left child of node "+a+" doesn't know who his father is!";if(this.compare(a.lChild.value,a.value)>0)throw"Key of left child of node "+a+" is greater than the value of his parent!";this.sanityCheck(a.lChild)}if(a.rChild){if(a.rChild.parent!==
a)throw"Left child of node "+a+" doesn't know who his father is!";if(this.compare(a.rChild.value,a.value)<0)throw"Key of left child of node "+a+" is less than the value of his parent!";this.sanityCheck(a.rChild)}}};e.prototype.recomputeHeights=function(a){for(var b=true;a&&b;){b=a.height;a.height=a.rChild||a.lChild?a.maxChildHeight()+1:0;b=a.height!==b;a=a.parent}};e.prototype.addAsChild=function(a,b){var f=null,g;g=this.compare(b.value,a.value);if(g<0)f=this.addLeftChild(a,b);else if(g>0)f=this.addRightChild(a,
b);else this.addEqualChild(a,b);f&&this.rebalance(f)};e.prototype.addLeftChild=function(a,b){b.gt=a;var f=null,g;if(a.lChild)this.addAsChild(a.lChild,b);else{a.lChild=b;b.parent=a;if(a.lt)a.lt.gt=b;a.lt=b;if(a.height===0)for(g=a;g;){g.height=g.maxChildHeight()+1;if(!g.isBalanced()){f=g;break}g=g.parent}}return f};e.prototype.addRightChild=function(a,b){b.lt=a;var f=null,g;if(a.rChild)this.addAsChild(a.rChild,b);else{a.rChild=b;b.parent=a;if(a.gt)a.gt.lt=b;a.gt=b;if(a.height===0)for(g=a;g;){g.height=
g.maxChildHeight()+1;if(!g.isBalanced()){f=g;break}g=g.parent}}return f};e.prototype.addEqualChild=function(a,b){b.eq=a.eq;a.eq=b;b.lt=null;b.gt=null};e.prototype.removeNode=function(a){this.elements-=1;if(a.eq)a.eq.assign(a);else{if(a.lt)a.lt.gt=a.gt;if(a.gt)a.gt.lt=a.lt;if(a.isLeaf())this.removeLeaf(a);else a.isBranch()?this.removeBranch(a):this.swapAndRemove(a)}};e.prototype.removeLeaf=function(a){var b=a.parent;if(b){if(b.lChild===a)b.lChild=null;else b.rChild=null;this.recomputeHeights(b)}else this.root=
null;for(a=b;a;){a.isBalanced()||this.rebalance(a);a=a.parent}};e.prototype.removeBranch=function(a){var b=a.parent;if(b){if(b.lChild)b.lChild=a.rChild||a.lChild;else b.rChild=a.rChild||a.lChild;if(a.lChild)a.lChild.parent=b;else a.rChild.parent=b;this.recomputeHeights(b)}for(a=b;a;){a.isBalanced()||this.rebalance(a);a=a.parent}};e.prototype.swapAndRemove=function(a){var b=this.findSmallest(a.rChild);this.swapNodes(a,b);a.height===0?this.removeLeaf(a):this.removeBranch(a)};e.prototype.swapNodes=function(a,
b){var f=a.parent,g=a.lChild,j=a.rChild,i=b.parent,m=b.lChild,k=b.rChild,l;l=a.height;a.height=b.height;b.height=l;if(f){if(f.lChild===a)f.lChild=b;else f.rChild=b;b.parent=f}else{this.root=b;b.parent=null}b.lChild=g;g.parent=b;a.lChild=m;if(a.rChild=k)k.parent=a;else if(i!==a){b.rChild=j;j.parent=b;i.lChild=a;a.parent=i}else{b.rChild=a;a.parent=b}};c.Tree=e})(window);(function(h){function e(){}Function.prototype.inherits=function(c){var d=new c;d.__proto__=d;d.__super__=c;this.prototype=d;this.prototype.constructor=this};e.inherits(Function);e.prototype.extend=function(){var c,d,a,b,f,g;c=this.__proto__;d=arguments;g=d.length;for(f=0;f<g;++f)if(a=d[f])for(b in a)if(a.hasOwnProperty(b))c[b]=a[b]};h.DllBest={Base:e}})(window);(function(h){function e(c){this.value=c}e.inherits(DllBest.Base);e.prototype.parent=null;e.prototype.lChild=null;e.prototype.rChild=null;e.prototype.height=0;e.prototype.lt=null;e.prototype.gt=null;e.prototype.eq=null;e.prototype.assign=function(c,d){this.parent=c.parent;this.lChild=c.lChild;this.rChild=c.rChild;if(this.lChild)this.lChild.parent=this;if(this.rChild)this.rChild.parent=this;if(d){this.value=c.value;this.eq=c.eq}this.lt=c.lt;this.gt=c.gt;if(this.lt)this.lt.gt=this;if(this.gt)this.gt.lt=
this};e.prototype.toString=function(){return"("+this.value+")"};h.DllBest.Node=e})(window);(function(h){function e(c,d){this.N=c;this.compare=d}h=h.DllBest||(h.DllBest={});e.inherits(DllBest.Base);e.prototype.compare=null;e.prototype.height=function(){if(this.root)return this.root.height;return 0};e.prototype.biggest=function(){if(this.root)return this.findBiggest(this.root);return null};e.prototype.smallest=function(){if(this.root)return this.findSmallest(this.root);return null};e.prototype.N=null;e.prototype.root=null;e.prototype.elements=0;e.prototype.tryInsert=function(c){if(!this.root){this.root=
new this.N(c);return true}if(!this.find(c)){this.addAsChild(this.root,new this.N(c));this.elements+=1;return true}return false};e.prototype.append=function(c){c=new this.N(c);if(this.root){this.addAsChild(this.root,c);this.elements+=1}else this.root=c};e.prototype.findBiggest=function(c){for(;c.rChild;)c=c.rChild;return c};e.prototype.findSmallest=function(c){for(;c.lChild;)c=c.lChild;return c};e.prototype.preorder=function c(d,a){if(!d)d=this.root;a||(a=[]);if(!d)return a;a.push(d.value);for(var b=
d;b=b.eq;)a.push(b.value);d.lChild&&c(d.lChild,a);d.rChild&&c(d.rChild,a);return a};e.prototype.inorder=function c(d,a){if(!d)d=this.root;a||(a=[]);if(!d)return a;d.lChild&&c(d.lChild,a);a.push(d.value);for(var b=d;b=b.eq;)a.push(b.value);d.rChild&&c(d.rChild,a);return a};e.prototype.postorder=function c(d,a){if(!d)d=this.root;a||(a=[]);if(!d)return a;d.lChild&&c(d.lChild,a);d.rChild&&c(d.rChild,a);a.push(d.value);for(var b=d;b=b.eq;)a.push(b.value);return a};e.prototype.find=function(c){return this.findInSubtree(this.root,
c)};e.prototype.findInSubtree=function c(d,a){if(!d)return null;var b=this.compare(a,d.value);if(b<0)return c(d.lChild,a);if(b>0)return c(d.rChild,a);return d};e.prototype.remove=function(c){if(c=this.find(c)){this.removeNode(c);return true}return false};e.prototype.getRange=function(c,d){for(var a=[],b=this.root,f;b;){f=this.compare(b.value,c);if(f<0)b=b.rChild;else if(f>0&&b.lChild)b=b.lChild;else break}for(;b&&this.compare(b.value,d)<=0;){a.push(b.value);for(f=b;f=f.eq;)a.push(f.value);b=b.gt}return a};
e.prototype.dlldump=function(){for(var c=this.smallest(),d=[],a;c;){d.push(c.value);for(a=c;a=a.eq;)d.push(a.value);c=c.gt}return d};e.prototype.dequeue=function(){var c=this.biggest();if(c){this.removeNode(c);return c.value}return null};h.Tree=e})(window);
